# .github/workflows/use-payload.yml
name: Use Dynamic Payload

on:
  workflow_dispatch:

jobs:
  use-artifact:
    runs-on: ubuntu-latest

    steps:
      - name: Download artifact from Workflow A
        uses: actions/download-artifact@v4
        with:
          name: dynamic-payload
          path: ./payload

      - name: Show downloaded payload
        run: cat ./payload/payload.json

      - name: Export all payload keys as environment variables
        run: |
          echo "Exporting dynamic payload variables..."
          while IFS== read -r key value; do
            echo "$key=$value" >> $GITHUB_ENV
          done < <(jq -r 'to_entries[] | "\(.key)=\(.value)"' ./payload/payload.json)

      # - name: Use the dynamic environment variables
      #   run: |
      #     echo "ENV_TYPE: $ENV_TYPE"
      #     echo "Job URL: $job_url"
